getgenv().LoopRunning = false
local lp = game:GetService("Players").LocalPlayer
local rems = lp:WaitForChild("Remotes")
local StarterGui = game:GetService("StarterGui")

-- Remotes
local gR = rems:WaitForChild("DeliverGift")
local mR = rems:WaitForChild("SubmitWinterMinigame")
local pD = rems:WaitForChild("PlayerDataEvent")
local nS = rems:WaitForChild("GetNewSanta")

-- UI Detection
local mainGui = lp:WaitForChild("PlayerGui"):WaitForChild("MainGui")
local winterUI = mainGui:WaitForChild("WinterEvent")

-- Function to check Santa Task
local function checkSantaTask()
    if not winterUI.Visible then
        StarterGui:SetCore("SendNotification", {
            Title = "ðŸŽ… Santa Status",
            Text = "No active task. Go talk to Santa!",
            Duration = 5,
            Icon = "rbxassetid://15814531102"
        })
    else
        -- Attempts to find the text label describing the task
        -- Usually found in 'WinterEvent -> ImageLabel -> Task/Text'
        local taskText = "Unknown Task"
        pcall(function()
            -- Adjusting for typical Doodle World UI structure
            taskText = winterUI:FindFirstChild("Task", true).Text 
        end)

        StarterGui:SetCore("SendNotification", {
            Title = "ðŸ“œ Current Task",
            Text = taskText,
            Duration = 7,
            Icon = "rbxassetid://15814532687"
        })
    end
end

-- GUI Setup (Fancy & Draggable)
local sg = Instance.new("ScreenGui", lp.PlayerGui)
local main = Instance.new("TextButton", sg)
main.Size, main.Position, main.Text = UDim2.new(0, 180, 0, 60), UDim2.new(0, 30, 0.5, -30), "SELECT MODE"
main.BackgroundColor3, main.TextColor3, main.Font, main.TextSize = Color3.fromRGB(30, 30, 30), Color3.new(1, 1, 1), Enum.Font.GothamBold, 18
Instance.new("UICorner", main).CornerRadius = UDim.new(0, 8)

local list = Instance.new("Frame", main)
list.Size, list.Position, list.Visible = UDim2.new(1, 0, 0, 360), UDim2.new(0, 0, 1, 5), false
list.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
Instance.new("UICorner", list).CornerRadius = UDim.new(0, 8)

-- (Draggable logic remains the same as your previous working version)
local UserInputService = game:GetService("UserInputService")
local dragToggle, dragInput, dragStart, startPos
main.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragToggle, dragStart, startPos = true, input.Position, main.Position
        input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragToggle = false end end)
    end
end)
UserInputService.InputChanged:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseMovement then dragInput = input end end)
UserInputService.InputChanged:Connect(function(input) if input == dragInput and dragToggle then 
    local delta = input.Position - dragStart
    main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end end)

-- Create Buttons including the New Task Checker
local buttons = {"A","B","C","D","Games","All","Santa","Check Task"}
for i, n in ipairs(buttons) do
    local b = Instance.new("TextButton", list)
    b.Size, b.Position, b.Text = UDim2.new(1, -10, 0, 40), UDim2.new(0, 5, 0, (i-1)*45 + 5), n
    b.BackgroundColor3, b.TextColor3, b.Font = Color3.fromRGB(45, 45, 45), Color3.new(1, 1, 1), Enum.Font.Gotham
    Instance.new("UICorner", b).CornerRadius = UDim.new(0, 4)
    
    b.MouseButton1Click:Connect(function()
        if n == "Check Task" then
            checkSantaTask()
        else
            -- (Your existing 'run' function logic for A,B,C,D,Games,All,Santa)
            -- Referencing your previously perfected 'run(m)' logic here
            list.Visible = false
            -- [Logic executed based on n]
        end
    end)
end

main.MouseButton1Click:Connect(function() list.Visible = not list.Visible end)
