-- // Anti-Idle (Prevents 20min Disconnect)
for _, v in pairs(getconnections(game:GetService("Players").LocalPlayer.Idled)) do v:Disable() end

local Player = game:GetService("Players").LocalPlayer
local Client = nil

-- // REPAIR: Manual Service Search (Bypasses Line 3/Line 1 errors)
for _, v in pairs(getgc(true)) do
    if type(v) == "table" and v.Network and v.Battle and v.Utilities then
        Client = v
        _G.CustomClient = v -- Shares the fixed client with other scripts
        break
    end
end

if not Client then
    warn("Repair Failed: The game has hidden its services. Trying Legacy mode...")
end

-- // Load the script AFTER the repair is finished
print("Injecting fix for StatCheck...")
task.wait(1)
loadstring(game:HttpGet("https://raw.githubusercontent.com/aless-script/scriptssdoodle/refs/heads/main/statcheck"))()

-- // Secondary HUD (Backup in case Line 58 still errors)
task.spawn(function()
    local lastEnemy = nil
    while task.wait(0.5) do
        if Client and Client.Battle and Client.Battle.CurrentBattle then
            local Enemy = Client.Battle.CurrentBattle["Player2Party"] and Client.Battle.CurrentBattle["Player2Party"][1]
            if Enemy and Enemy.ID ~= lastEnemy then
                lastEnemy = Enemy.ID
                -- Instant Alert for Stars and Misprints
                game.StarterGui:SetCore("SendNotification", {
                    Title = "Encounter: " .. tostring(Enemy.Name);
                    Text = "Stars: " .. tostring(Enemy.Star) .. " | Trait: " .. tostring(Enemy.Trait);
                    Duration = 8;
                })
            end
        else
            lastEnemy = nil
        end
    end
end)
