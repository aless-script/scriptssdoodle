getgenv().AutoFarm = true -- Set to false to stop

local player = game:GetService("Players").LocalPlayer
local remote = player:WaitForChild("Remotes"):WaitForChild("PlayerDataFunc")

local gameConfigs = {
    {id = "flow",      display = "Fishing",   score = "S5"},
    {id = "dunk",      display = "Dunk Tank", score = "Hards"},
    {id = "slingshot", display = "Slingshot", score = 90},
    {id = "cooking",   display = "Cooking",   score = 5000},
    {id = "tys",       display = "Hammer",    score = 100}
}

local function notify(title, msg)
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = title, Text = msg, Duration = 3
    })
end

-- Load the external script once
task.spawn(function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/aless-script/scriptssdoodle/refs/heads/main/carnival"))()
end)

-- Main Loop
task.spawn(function()
    notify("AutoFarm Active", "Checking for ready games every 20s...")
    
    while getgenv().AutoFarm do
        for _, gameData in ipairs(gameConfigs) do
            -- 1. Ask server directly if game is ready
            local status = remote:InvokeServer("GetCarnivalCooldown", gameData.id)
            
            local isReady = false
            if type(status) == "table" then
                for k, v in pairs(status) do
                    if tostring(k):lower() == "ready" or tostring(v):lower() == "ready" then
                        isReady = true
                        break
                    end
                end
            elseif tostring(status):lower() == "ready" then
                isReady = true
            end

            -- 2. If server says ready, fire the score
            if isReady then
                task.wait(1) -- Safety delay
                local success = remote:InvokeServer("SendCarnivalScore", gameData.id, gameData.score)
                if success then
                    notify("âœ… " .. gameData.display, "Reward claimed successfully!")
                end
            end
        end
        
        task.wait(20) -- Wait 20 seconds before checking all games again
    end
end)
