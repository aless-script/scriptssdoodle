getgenv().AutoFarm = true 

local remote = game:GetService("Players").LocalPlayer:WaitForChild("Remotes"):WaitForChild("PlayerDataFunc")

local gameConfigs = {
    {id = "flow",      display = "Fishing",   score = "S5",    cd = 65},
    {id = "dunk",      display = "Dunk Tank", score = "Hards", cd = 185},
    {id = "slingshot", display = "Slingshot", score = 90,      cd = 185},
    {id = "cooking",   display = "Cooking",   score = 5000,    cd = 185},
    {id = "tys",       display = "Hammer",    score = 100,     cd = 185}
}

local function notify(title, msg)
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = title, Text = msg, Duration = 5
    })
end

-- Load the External GUI once
task.spawn(function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/aless-script/scriptssdoodle/refs/heads/main/carnival"))()
end)

local function runGameLoop(data)
    task.spawn(function()
        while getgenv().AutoFarm do
            -- Step 1: Check Cooldown (Silent)
            local response = remote:InvokeServer("GetCarnivalCooldown", data.id)
            
            local isReady = false
            if type(response) == "table" then
                for k, v in pairs(response) do
                    if tostring(v):lower() == "ready" or tostring(k):lower() == "ready" then isReady = true break end
                end
            elseif tostring(response):lower() == "ready" then
                isReady = true
            end

            if isReady then
                task.wait(math.random(3, 7)) -- Randomize delay to look human
                local success = remote:InvokeServer("SendCarnivalScore", data.id, data.score)
                
                -- ONLY notify on a successful claim
                if success then
                    notify("ðŸ’° Ticket Claimed", "Earned rewards for " .. data.display)
                end
                
                task.wait(data.cd) -- Sleep for the duration of the cooldown
            else
                -- If not ready, wait a longer time (30s) before checking again to reduce remote spam
                task.wait(30)
            end
        end
    end)
end

-- Start the silent farm
notify("Silent Farm", "Autofarm is now running in the background. Notifications will only appear when tickets are earned.")

for i, config in ipairs(gameConfigs) do
    task.wait(2) -- Stagger the start of each game loop
    runGameLoop(config)
end
