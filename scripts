getgenv().LoopRunning = false
local lp = game:GetService("Players").LocalPlayer
local rems = lp:WaitForChild("Remotes")
local gR, mR = rems:WaitForChild("DeliverPresent"), rems:WaitForChild("SubmitWinterMinigame")
local pD = rems:WaitForChild("PlayerDataEvent")
local nS = rems:WaitForChild("GetNewSanta")

-- GUI Setup
local sg = Instance.new("ScreenGui", lp.PlayerGui)
local main = Instance.new("TextButton", sg)
main.Size, main.Position, main.Text = UDim2.new(0, 180, 0, 60), UDim2.new(0, 30, 0.5, -30), "SELECT MODE"
main.BackgroundColor3, main.TextColor3, main.Font, main.TextSize = Color3.fromRGB(30, 30, 30), Color3.new(1, 1, 1), Enum.Font.GothamBold, 18
main.AutoButtonColor = false
Instance.new("UICorner", main).CornerRadius = UDim.new(0, 8)

local list = Instance.new("Frame", main)
list.Size, list.Position, list.Visible = UDim2.new(1, 0, 0, 285), UDim2.new(0, 0, 1, 5), false
list.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
Instance.new("UICorner", list).CornerRadius = UDim.new(0, 8)

-- Draggable Logic
local dragging, dragInput, dragStart, startPos
main.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = main.Position
    end
end)
main.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then dragInput = input end
end)
game:GetService("UserInputService").InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)
game:GetService("UserInputService").InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
end)

-- Main Execution Logic
local function run(m)
    list.Visible, getgenv().LoopRunning = false, true
    main.Text, main.BackgroundColor3 = "RUNNING: "..m, Color3.fromRGB(0, 150, 70)
    
    local function p()
        for _, d in {{26,"WhackAMole"},{101.66,"Matching"},{2.01,"Knitting"},{10,"Flow"}} do
            if not getgenv().LoopRunning then break end
            mR:InvokeServer(d[1], d[2], 3) task.wait(0.83)
        end
    end

    if m == "Santa" then
        pD:FireServer("ToggleBusy", true)
        task.wait(0.8)
        nS:InvokeServer()
        task.wait(0.6)
        pD:FireServer("ToggleBusy", false)
    elseif m == "All" then
        gR:InvokeServer() task.wait(0.83)
        p()
    elseif m == "Games" then 
        p()
    else 
        gR:InvokeServer(m) task.wait(0.83)
    end

    getgenv().LoopRunning, main.Text, main.BackgroundColor3 = false, "SELECT MODE", Color3.fromRGB(30, 30, 30)
end

-- Create Buttons
local buttons = {"A","B","C","D","Games","All","Santa"}
for i, n in ipairs(buttons) do
    local b = Instance.new("TextButton", list)
    b.Size, b.Position, b.Text = UDim2.new(1, -10, 0, 35), UDim2.new(0, 5, 0, (i-1)*40 + 5), n
    b.BackgroundColor3, b.TextColor3, b.Font = Color3.fromRGB(45, 45, 45), Color3.new(1, 1, 1), Enum.Font.Gotham
    b.TextSize = 14
    Instance.new("UICorner", b).CornerRadius = UDim.new(0, 4)
    b.MouseButton1Click:Connect(function() run(n) end)
end

-- Toggle Menu
main.MouseButton1Click:Connect(function() 
    if getgenv().LoopRunning then 
        getgenv().LoopRunning = false 
    else 
        list.Visible = not list.Visible 
    end 
end)
