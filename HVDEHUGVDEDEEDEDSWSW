local player = game:GetService("Players").LocalPlayer

-- Create GUI
local gui = Instance.new("ScreenGui")
gui.Name = "DoodleStatViewer"
gui.ResetOnSpawn = false
gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Main Frame
local main = Instance.new("Frame")
main.Size = UDim2.new(0, 450, 0, 550)
main.Position = UDim2.new(0.5, -225, 0.5, -275)
main.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
main.BorderSizePixel = 0
main.Active = true
main.Draggable = true
main.Parent = gui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 10)
corner.Parent = main

-- Title Bar
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 40)
title.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
title.BorderSizePixel = 0
title.Text = "ğŸ” Doodle Stat Viewer"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Font = Enum.Font.GothamBold
title.TextSize = 16
title.Parent = main

local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 10)
titleCorner.Parent = title

-- Close Button
local close = Instance.new("TextButton")
close.Size = UDim2.new(0, 30, 0, 30)
close.Position = UDim2.new(1, -35, 0, 5)
close.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
close.Text = "X"
close.TextColor3 = Color3.fromRGB(255, 255, 255)
close.Font = Enum.Font.GothamBold
close.TextSize = 14
close.BorderSizePixel = 0
close.Parent = title

local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(0, 6)
closeCorner.Parent = close

close.MouseButton1Click:Connect(function()
    gui:Destroy()
end)

-- Status Label
local statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(1, -20, 0, 30)
statusLabel.Position = UDim2.new(0, 10, 0, 50)
statusLabel.BackgroundTransparency = 1
statusLabel.Text = "â³ Waiting for doodle encounter..."
statusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
statusLabel.Font = Enum.Font.GothamBold
statusLabel.TextSize = 13
statusLabel.TextXAlignment = Enum.TextXAlignment.Left
statusLabel.Parent = main

-- Doodle Info Frame
local infoFrame = Instance.new("ScrollingFrame")
infoFrame.Size = UDim2.new(1, -20, 0, 420)
infoFrame.Position = UDim2.new(0, 10, 0, 90)
infoFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
infoFrame.BorderSizePixel = 0
infoFrame.ScrollBarThickness = 6
infoFrame.Visible = false
infoFrame.Parent = main

local infoCorner = Instance.new("UICorner")
infoCorner.CornerRadius = UDim.new(0, 8)
infoCorner.Parent = infoFrame

local infoList = Instance.new("UIListLayout")
infoList.Padding = UDim.new(0, 8)
infoList.Parent = infoFrame

local infoPadding = Instance.new("UIPadding")
infoPadding.PaddingTop = UDim.new(0, 10)
infoPadding.PaddingLeft = UDim.new(0, 10)
infoPadding.PaddingRight = UDim.new(0, 10)
infoPadding.Parent = infoFrame

-- Copy ID Button
local copyBtn = Instance.new("TextButton")
copyBtn.Size = UDim2.new(1, -20, 0, 35)
copyBtn.Position = UDim2.new(0, 10, 1, -45)
copyBtn.BackgroundColor3 = Color3.fromRGB(50, 150, 255)
copyBtn.Text = "ğŸ“‹ Copy Doodle ID"
copyBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
copyBtn.Font = Enum.Font.GothamBold
copyBtn.TextSize = 13
copyBtn.BorderSizePixel = 0
copyBtn.Visible = false
copyBtn.Parent = main

local copyCorner = Instance.new("UICorner")
copyCorner.CornerRadius = UDim.new(0, 6)
copyCorner.Parent = copyBtn

-- Safe parent assignment
pcall(function()
    if gethui then
        gui.Parent = gethui()
    elseif syn and syn.protect_gui then
        syn.protect_gui(gui)
        gui.Parent = player.PlayerGui
    else
        gui.Parent = player.PlayerGui
    end
end)

-- Helper function to create stat display
local function createStatLabel(text, value, color)
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 0, 25)
    label.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
    label.BorderSizePixel = 0
    label.Text = text .. ": " .. tostring(value)
    label.TextColor3 = color or Color3.fromRGB(255, 255, 255)
    label.Font = Enum.Font.Gotham
    label.TextSize = 12
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = infoFrame
    
    local padding = Instance.new("UIPadding")
    padding.PaddingLeft = UDim.new(0, 10)
    padding.Parent = label
    
    local labelCorner = Instance.new("UICorner")
    labelCorner.CornerRadius = UDim.new(0, 6)
    labelCorner.Parent = label
    
    return label
end

-- Helper function to create section header
local function createHeader(text)
    local header = Instance.new("TextLabel")
    header.Size = UDim2.new(1, 0, 0, 30)
    header.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
    header.BorderSizePixel = 0
    header.Text = text
    header.TextColor3 = Color3.fromRGB(100, 200, 255)
    header.Font = Enum.Font.GothamBold
    header.TextSize = 14
    header.TextXAlignment = Enum.TextXAlignment.Left
    header.Parent = infoFrame
    
    local padding = Instance.new("UIPadding")
    padding.PaddingLeft = UDim.new(0, 10)
    padding.Parent = header
    
    local headerCorner = Instance.new("UICorner")
    headerCorner.CornerRadius = UDim.new(0, 6)
    headerCorner.Parent = header
    
    return header
end

-- Function to parse and display doodle data
local currentDoodleID = nil

local function displayDoodleData(data)
    pcall(function()
        -- Clear previous data
        for _, child in ipairs(infoFrame:GetChildren()) do
            if not child:IsA("UIListLayout") and not child:IsA("UIPadding") then
                child:Destroy()
            end
        end
        
        if type(data) ~= "table" then
            statusLabel.Text = "âŒ Invalid data format"
            infoFrame.Visible = false
            copyBtn.Visible = false
            return
        end
        
        statusLabel.Text = "âœ… Doodle Encountered!"
        infoFrame.Visible = true
        copyBtn.Visible = true
        
        -- Basic Info
        createHeader("ğŸ“‹ Basic Information")
        
        if data.ID or data.id then
            currentDoodleID = tostring(data.ID or data.id)
            createStatLabel("ID", currentDoodleID, Color3.fromRGB(100, 200, 255))
        end
        
        if data.Name or data.name or data.RealName then
            createStatLabel("Name", data.Name or data.name or data.RealName, Color3.fromRGB(255, 200, 100))
        end
        
        if data.Level or data.level then
            createStatLabel("Level", data.Level or data.level, Color3.fromRGB(150, 255, 150))
        end
        
        if data.Species or data.species or data.RealName then
            createStatLabel("Species", data.Species or data.species or data.RealName, Color3.fromRGB(255, 150, 255))
        end
        
        -- Stats
        if data.Stats or data.stats then
            createHeader("âš”ï¸ Stats")
            local stats = data.Stats or data.stats
            
            if type(stats) == "table" then
                for statName, statValue in pairs(stats) do
                    local color = Color3.fromRGB(200, 200, 200)
                    if statName:lower():find("hp") or statName:lower():find("health") then
                        color = Color3.fromRGB(255, 100, 100)
                    elseif statName:lower():find("attack") or statName:lower() == "atk" then
                        color = Color3.fromRGB(255, 150, 100)
                    elseif statName:lower():find("defense") or statName:lower() == "def" then
                        color = Color3.fromRGB(100, 150, 255)
                    elseif statName:lower():find("speed") or statName:lower() == "spe" then
                        color = Color3.fromRGB(100, 255, 200)
                    elseif statName:lower() == "matk" then
                        color = Color3.fromRGB(255, 200, 100)
                    elseif statName:lower() == "mdef" then
                        color = Color3.fromRGB(150, 100, 255)
                    end
                    createStatLabel(statName, statValue, color)
                end
            end
        end
        
        -- IVs (Individual Values)
        if data.Iv or data.iv or data.IVs or data.ivs then
            createHeader("ğŸ§¬ IVs (Individual Values)")
            
            local iv = data.Iv or data.iv
            if iv then
                createStatLabel("IV Value", iv, Color3.fromRGB(255, 255, 150))
            end
            
            local ivs = data.IVs or data.ivs
            if type(ivs) == "table" then
                for ivName, ivValue in pairs(ivs) do
                    createStatLabel(ivName, ivValue, Color3.fromRGB(255, 255, 150))
                end
            end
        end
        
        -- Traits/Abilities
        if data.Trait or data.trait or data.Ability or data.ability then
            createHeader("âœ¨ Traits/Abilities")
            createStatLabel("Ability", data.Trait or data.trait or data.Ability or data.ability, Color3.fromRGB(255, 200, 255))
        end
        
        if data.HiddenTrait or data.hiddenTrait then
            createStatLabel("Hidden Trait", data.HiddenTrait or data.hiddenTrait, Color3.fromRGB(255, 100, 255))
        end
        
        -- Skin/Appearance
        createHeader("ğŸ¨ Appearance")
        
        if data.Skin or data.skin then
            createStatLabel("Skin", data.Skin or data.skin, Color3.fromRGB(255, 200, 150))
        end
        
        if data.Color or data.color then
            createStatLabel("Color", data.Color or data.color, Color3.fromRGB(150, 200, 255))
        end
        
        if data.Shiny ~= nil then
            createStatLabel("Shiny", tostring(data.Shiny), Color3.fromRGB(255, 215, 0))
        end
        
        if data.Size or data.size then
            createStatLabel("Size", data.Size or data.size, Color3.fromRGB(200, 255, 200))
        end
        
        if data.Gender or data.gender then
            createStatLabel("Gender", data.Gender or data.gender, Color3.fromRGB(255, 180, 255))
        end
        
        if data.Star or data.star then
            createStatLabel("Stars", data.Star or data.star, Color3.fromRGB(255, 255, 100))
        end
        
        -- Moves/Skills
        if data.Moves or data.moves or data.Skills or data.skills then
            createHeader("ğŸ’« Moves")
            local moves = data.Moves or data.moves or data.Skills or data.skills
            
            if type(moves) == "table" then
                for i, move in ipairs(moves) do
                    if type(move) == "table" then
                        local moveName = move.Name or move.name or "Move " .. i
                        local moveInfo = moveName
                        if move.Uses then
                            moveInfo = moveInfo .. " (Uses: " .. move.Uses .. ")"
                        end
                        createStatLabel("Move " .. i, moveInfo, Color3.fromRGB(200, 150, 255))
                    else
                        createStatLabel("Move " .. i, move, Color3.fromRGB(200, 150, 255))
                    end
                end
            end
        end
        
        -- Additional Data
        createHeader("ğŸ“Š Additional Info")
        
        if data.Wild ~= nil then
            createStatLabel("Wild", tostring(data.Wild), Color3.fromRGB(100, 255, 100))
        end
        
        if data.Friendship or data.friendship then
            createStatLabel("Friendship", data.Friendship or data.friendship, Color3.fromRGB(255, 150, 150))
        end
        
        if data.Experience or data.experience then
            createStatLabel("Experience", data.Experience or data.experience, Color3.fromRGB(150, 255, 255))
        end
        
        if data.DateMet or data.dateMet then
            createStatLabel("Date Met", data.DateMet or data.dateMet, Color3.fromRGB(200, 200, 255))
        end
        
        infoFrame.CanvasSize = UDim2.new(0, 0, 0, infoList.AbsoluteContentSize.Y + 20)
    end)
end

-- Copy button functionality
copyBtn.MouseButton1Click:Connect(function()
    if currentDoodleID then
        setclipboard(currentDoodleID)
        copyBtn.Text = "âœ… ID Copied!"
        task.wait(2)
        copyBtn.Text = "ğŸ“‹ Copy Doodle ID"
    end
end)

-- Hook into game remotes to capture doodle data
local function hookDoodleData()
    local oldNamecall
    
    local hookFunc = function(self, ...)
        local method = getnamecallmethod()
        local args = {...}
        
        if method == "FireServer" or method == "InvokeServer" then
            local success, remoteName = pcall(function() return self.Name end)
            
            if success and remoteName then
                -- Specifically look for StartBattle remote
                if remoteName == "StartBattle" then
                    print("[Doodle Viewer] ğŸ¯ Battle Started!")
                    
                    if #args >= 1 and type(args[1]) == "table" then
                        local battleData = args[1]
                        
                        -- Extract wild doodle from Player2Party (the enemy/wild doodle)
                        if battleData.Player2Party and type(battleData.Player2Party) == "table" then
                            print("[Doodle Viewer] ğŸ“¦ Found wild doodle data!")
                            
                            -- Get the first doodle in enemy party
                            local wildDoodle = battleData.Player2Party[1]
                            
                            if wildDoodle then
                                print("[Doodle Viewer] ğŸ“‹ Wild Doodle Info:")
                                print("    Name: " .. tostring(wildDoodle.Name or wildDoodle.RealName))
                                print("    Level: " .. tostring(wildDoodle.Level))
                                print("    Shiny: " .. tostring(wildDoodle.Shiny))
                                
                                task.spawn(function()
                                    displayDoodleData(wildDoodle)
                                end)
                            end
                        end
                    end
                end
                
                local lowerName = remoteName:lower()
                
                -- Also check other potential remotes
                if lowerName:find("encounter") or lowerName:find("wild") or 
                   lowerName:find("spawn") or lowerName:find("catch") then
                    
                    print("[Doodle Viewer] ğŸ¯ Detected: " .. remoteName)
                    
                    for i, arg in ipairs(args) do
                        if type(arg) == "table" then
                            print("[Doodle Viewer] ğŸ“¦ Table found in arg #" .. i)
                            task.spawn(function()
                                displayDoodleData(arg)
                            end)
                            break
                        end
                    end
                end
            end
        end
        
        return oldNamecall(self, ...)
    end
    
    -- Try different hooking methods based on executor
    if hookmetamethod then
        if newcclosure then
            oldNamecall = hookmetamethod(game, "__namecall", newcclosure(hookFunc))
        else
            oldNamecall = hookmetamethod(game, "__namecall", hookFunc)
        end
    elseif hookfunction then
        local mt = getrawmetatable(game)
        setreadonly(mt, false)
        oldNamecall = mt.__namecall
        mt.__namecall = hookFunc
        setreadonly(mt, true)
    else
        warn("[Doodle Viewer] âš ï¸ No hook method available!")
        return
    end
    
    print("[Doodle Viewer] âœ… Hooks active!")
    print("[Doodle Viewer] ğŸ‘€ Watching for StartBattle...")
end

-- Initialize
task.spawn(function()
    task.wait(1)
    hookDoodleData()
end)

-- Manual test function
_G.testDoodleViewer = function(data)
    displayDoodleData(data)
end

_G.showDoodleViewer = function()
    gui.Enabled = true
end

_G.hideDoodleViewer = function()
    gui.Enabled = false
end

print([[
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ğŸ” DOODLE STAT VIEWER
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… Loaded! Listening for encounters
ğŸ“Š GUI will show when doodles spawn
ğŸ”§ Check console for remote names

Commands:
  _G.testDoodleViewer({data})
  _G.showDoodleViewer()
  _G.hideDoodleViewer()
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
]])
