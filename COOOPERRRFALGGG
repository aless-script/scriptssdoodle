-- Auto Battle Script with Automatic Info Gathering
-- Automatically detects targets, moves, and battle state

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")

-- Wait for character and remotes to load
local function waitForRemotes()
    repeat task.wait() until LocalPlayer.Character
    repeat task.wait() until LocalPlayer:FindFirstChild("Remotes")
end

pcall(waitForRemotes)

local Remotes = LocalPlayer.Remotes
local BattleActionEvent = Remotes:WaitForChild("BattleAction")
local RunAwayEvent = Remotes:WaitForChild("DudeWhyld")

-- Use _G for persistent storage
_G.AutoBattleSettings = _G.AutoBattleSettings or {
    AutoAttack = false,
    AutoRun = false,
    EnabledMoves = {
        [1] = true,
        [2] = true,
        [3] = true,
        [4] = true
    },
    AttackDelay = 0.5
}

_G.AutoBattleData = _G.AutoBattleData or {
    InBattle = false,
    CurrentMoves = {},
    CurrentTarget = nil,
    UserId = nil,
    Enemies = {},
    Location = nil,
    Terrain = nil
}

local Settings = _G.AutoBattleSettings
local BattleData = _G.AutoBattleData

-- Hook into BattleAction to capture data
local OriginalFireServer
local function hookBattleAction()
    pcall(function()
        OriginalFireServer = hookfunction(BattleActionEvent.FireServer, function(self, data, ...)
            -- Capture battle data from outgoing requests
            if data and type(data) == "table" and #data > 0 then
                local action = data[1]
                if action.User then
                    BattleData.UserId = action.User
                end
                if action.Target then
                    BattleData.CurrentTarget = action.Target
                    if not table.find(BattleData.Enemies, action.Target) then
                        table.insert(BattleData.Enemies, action.Target)
                    end
                end
                if action.Action then
                    if not table.find(BattleData.CurrentMoves, action.Action) then
                        table.insert(BattleData.CurrentMoves, action.Action)
                    end
                end
                BattleData.InBattle = true
            end
            
            return OriginalFireServer(self, data, ...)
        end)
    end)
end

-- Hook to detect battle start via StartBattle event
local function detectBattleStart()
    -- Hook StartBattle OnClientEvent
    pcall(function()
        if Remotes:FindFirstChild("StartBattle") then
            local StartBattleEvent = Remotes.StartBattle
            
            for _, Connection in getconnections(StartBattleEvent.OnClientEvent) do
                local old; old = hookfunction(Connection.Function, function(...)
                    local args = {...}
                    BattleData.InBattle = true
                    print("[Battle Detected] StartBattle triggered!", ...)
                    
                    -- Try to extract battle data from args
                    if args[1] and type(args[1]) == "table" then
                        if args[1].Enemies then
                            for _, enemy in pairs(args[1].Enemies) do
                                if type(enemy) == "string" then
                                    table.insert(BattleData.Enemies, enemy)
                                elseif type(enemy) == "table" and enemy.Id then
                                    table.insert(BattleData.Enemies, enemy.Id)
                                end
                            end
                        end
                    end
                    
                    return old(...)
                end)
            end
        end
    end)
    
    -- Also hook Iamloops1InitialReady as backup
    pcall(function()
        if Remotes:FindFirstChild("Iamloops1InitialReady") then
            local InitialReadyEvent = Remotes.Iamloops1InitialReady
            local OriginalInitialReady = hookfunction(InitialReadyEvent.FireServer, function(self, ...)
                BattleData.InBattle = true
                print("[Battle Detected] Battle ready!")
                return OriginalInitialReady(self, ...)
            end)
        end
    end)
end

-- Hook to detect battle end
local function detectBattleEnd()
    pcall(function()
        if Remotes:FindFirstChild("Iamloops1Over") then
            local BattleOverEvent = Remotes.Iamloops1Over
            
            -- Check what type of remote it is
            if BattleOverEvent:IsA("RemoteEvent") then
                -- It's a RemoteEvent, listen to OnClientEvent
                BattleOverEvent.OnClientEvent:Connect(function(...)
                    BattleData.InBattle = false
                    BattleData.CurrentTarget = nil
                    BattleData.Enemies = {}
                    print("[Battle Detected] Battle ended via OnClientEvent!")
                end)
                print("[Hook] Listening to Iamloops1Over.OnClientEvent")
            elseif BattleOverEvent:IsA("BindableEvent") then
                -- It's a BindableEvent
                BattleOverEvent.Event:Connect(function(...)
                    BattleData.InBattle = false
                    BattleData.CurrentTarget = nil
                    BattleData.Enemies = {}
                    print("[Battle Detected] Battle ended via Event!")
                end)
                print("[Hook] Listening to Iamloops1Over.Event")
            end
        end
    end)
end

-- Hook UpdateBattlingPlayers to detect battle state changes
local function detectBattleState()
    pcall(function()
        if Remotes:FindFirstChild("UpdateBattlingPlayers") then
            local UpdateEvent = Remotes.UpdateBattlingPlayers
            
            for _, Connection in getconnections(UpdateEvent.OnClientEvent) do
                local old; old = hookfunction(Connection.Function, function(...)
                    local args = {...}
                    print("[Battle State] UpdateBattlingPlayers:", ...)
                    
                    -- args[1] is typically the player, args[2] is the battle state (true/false)
                    if args[2] ~= nil then
                        BattleData.InBattle = args[2]
                        if args[2] then
                            print("[Battle Detected] Player entered battle!")
                        else
                            print("[Battle Detected] Player left battle!")
                            BattleData.CurrentTarget = nil
                            BattleData.Enemies = {}
                        end
                    end
                    
                    return old(...)
                end)
            end
        end
    end)
end

-- Hook to capture location/terrain data
local OriginalRunAway
local function hookRunAway()
    pcall(function()
        OriginalRunAway = hookfunction(RunAwayEvent.FireServer, function(self, location, terrain, ...)
            BattleData.Location = location or BattleData.Location
            BattleData.Terrain = terrain or BattleData.Terrain
            return OriginalRunAway(self, location, terrain, ...)
        end)
    end)
end

-- Scan player's GUI for battle information and interact with buttons
local function scanBattleGUI()
    task.spawn(function()
        while true do
            task.wait(0.5)
            
            local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
            
            for _, gui in pairs(PlayerGui:GetDescendants()) do
                if gui:IsA("TextLabel") or gui:IsA("TextButton") then
                    local text = gui.Text:lower()
                    
                    -- Detect battle state from GUI text
                    if text:match("battle") or text:match("fight") or text:match("wild") then
                        if not BattleData.InBattle then
                            BattleData.InBattle = true
                            print("[GUI Detection] Battle detected from GUI!")
                        end
                    end
                    
                    -- Detect battle end
                    if text:match("victory") or text:match("you won") or text:match("defeated") or text:match("ran away") then
                        if BattleData.InBattle then
                            BattleData.InBattle = false
                            BattleData.CurrentTarget = nil
                            BattleData.Enemies = {}
                            print("[GUI Detection] Battle ended!")
                        end
                    end
                    
                    -- Store move button references
                    if gui:IsA("TextButton") and (text:match("move") or gui.Name:match("Move") or gui.Name:match("Attack") or gui.Name:match("Skill")) then
                        local moveName = gui.Text
                        if moveName ~= "" and moveName ~= "Move" then
                            if not table.find(BattleData.CurrentMoves, moveName) then
                                table.insert(BattleData.CurrentMoves, moveName)
                                print("[Moves Detected] Found move button:", moveName)
                            end
                            
                            -- Store button reference for clicking
                            if not _G.MoveButtons then
                                _G.MoveButtons = {}
                            end
                            _G.MoveButtons[moveName] = gui
                        end
                    end
                    
                    -- Store run button reference
                    if gui:IsA("TextButton") and (text:match("run") or text:match("flee") or text:match("escape")) then
                        _G.RunButton = gui
                        print("[GUI Detection] Found run button:", gui.Name)
                    end
                end
            end
        end
    end)
end

-- Scan for ClientRunner data
local function scanClientRunner()
    if LocalPlayer:FindFirstChild("ClientRunner") then
        local ClientRunner = LocalPlayer.ClientRunner
        
        -- Try to find battle data in ClientRunner
        for _, child in pairs(ClientRunner:GetDescendants()) do
            if child:IsA("ValueBase") then
                print("[ClientRunner] Found value:", child.Name, "=", child.Value)
            end
        end
    end
end

-- Get best available target
local function getTarget()
    if BattleData.CurrentTarget then
        return BattleData.CurrentTarget
    elseif #BattleData.Enemies > 0 then
        return BattleData.Enemies[1]
    end
    return nil
end

-- Get user ID
local function getUserId()
    return BattleData.UserId
end

-- Get available moves
local function getAvailableMoves()
    if #BattleData.CurrentMoves > 0 then
        return BattleData.CurrentMoves
    end
    
    -- Fallback: try to detect from GUI
    local PlayerGui = LocalPlayer:FindFirstChild("PlayerGui")
    if PlayerGui then
        for _, gui in pairs(PlayerGui:GetDescendants()) do
            if gui:IsA("TextButton") and gui.Name:match("Move") then
                local moveName = gui.Text
                if moveName ~= "" then
                    table.insert(BattleData.CurrentMoves, moveName)
                end
            end
        end
    end
    
    return BattleData.CurrentMoves
end

-- Auto Attack Function
local function autoAttack()
    while Settings.AutoAttack do
        task.wait(Settings.AttackDelay)
        
        if not BattleData.InBattle then
            task.wait(1)
            continue
        end
        
        -- Try GUI button clicking first
        if _G.MoveButtons then
            for i, moveName in ipairs(BattleData.CurrentMoves) do
                if Settings.EnabledMoves[i] and Settings.AutoAttack then
                    local moveButton = _G.MoveButtons[moveName]
                    
                    if moveButton and moveButton.Parent then
                        -- Click the button in the GUI
                        local success, err = pcall(function()
                            -- Try multiple click methods
                            if moveButton.MouseButton1Click then
                                for _, connection in pairs(getconnections(moveButton.MouseButton1Click)) do
                                    connection:Fire()
                                end
                            end
                            
                            -- Also try simulating a click
                            local VirtualInputManager = game:GetService("VirtualInputManager")
                            local pos = moveButton.AbsolutePosition
                            local size = moveButton.AbsoluteSize
                            VirtualInputManager:SendMouseButtonEvent(pos.X + size.X/2, pos.Y + size.Y/2, 0, true, game, 0)
                            VirtualInputManager:SendMouseButtonEvent(pos.X + size.X/2, pos.Y + size.Y/2, 0, false, game, 0)
                        end)
                        
                        if success then
                            print("[Auto Attack] Clicked move button:", moveName)
                        else
                            warn("[Auto Attack] Failed to click button:", err)
                        end
                    else
                        -- Fall back to remote event
                        local moves = getAvailableMoves()
                        local target = getTarget()
                        local userId = getUserId()
                        
                        if target and userId and moves[i] then
                            local success, err = pcall(function()
                                if OriginalFireServer then
                                    OriginalFireServer(BattleActionEvent, {
                                        {
                                            Target = target,
                                            ActionType = "Attack",
                                            Action = moves[i],
                                            User = userId
                                        }
                                    })
                                else
                                    BattleActionEvent:FireServer({
                                        {
                                            Target = target,
                                            ActionType = "Attack",
                                            Action = moves[i],
                                            User = userId
                                        }
                                    })
                                end
                            end)
                            
                            if success then
                                print("[Auto Attack] Used:", moves[i], "on", target)
                            else
                                warn("[Auto Attack] Failed:", err)
                            end
                        end
                    end
                    
                    task.wait(Settings.AttackDelay)
                end
            end
        else
            -- No GUI buttons found, use remote events
            local moves = getAvailableMoves()
            local target = getTarget()
            local userId = getUserId()
            
            if not target or not userId then
                warn("[Auto Attack] Missing target or user ID, waiting...")
                task.wait(1)
                continue
            end
            
            for i, move in ipairs(moves) do
                if Settings.EnabledMoves[i] and Settings.AutoAttack then
                    local success, err = pcall(function()
                        if OriginalFireServer then
                            OriginalFireServer(BattleActionEvent, {
                                {
                                    Target = target,
                                    ActionType = "Attack",
                                    Action = move,
                                    User = userId
                                }
                            })
                        else
                            BattleActionEvent:FireServer({
                                {
                                    Target = target,
                                    ActionType = "Attack",
                                    Action = move,
                                    User = userId
                                }
                            })
                        end
                    end)
                    
                    if success then
                        print("[Auto Attack] Used:", move, "on", target)
                    else
                        warn("[Auto Attack] Failed:", err)
                    end
                    
                    task.wait(Settings.AttackDelay)
                end
            end
        end
    end
end

-- Auto Run Function
local function autoRun()
    if not BattleData.InBattle then
        print("[Auto Run] Not in battle!")
        return
    end
    
    -- Try clicking the run button in GUI first
    if _G.RunButton and _G.RunButton.Parent then
        local success, err = pcall(function()
            -- Try firing button connections
            if _G.RunButton.MouseButton1Click then
                for _, connection in pairs(getconnections(_G.RunButton.MouseButton1Click)) do
                    connection:Fire()
                end
            end
            
            -- Also try simulating a click
            local VirtualInputManager = game:GetService("VirtualInputManager")
            local pos = _G.RunButton.AbsolutePosition
            local size = _G.RunButton.AbsoluteSize
            VirtualInputManager:SendMouseButtonEvent(pos.X + size.X/2, pos.Y + size.Y/2, 0, true, game, 0)
            VirtualInputManager:SendMouseButtonEvent(pos.X + size.X/2, pos.Y + size.Y/2, 0, false, game, 0)
        end)
        
        if success then
            print("[Auto Run] Clicked run button in GUI")
            BattleData.InBattle = false
            return
        else
            warn("[Auto Run] Failed to click GUI button:", err)
        end
    end
    
    -- Fall back to remote event
    local location = BattleData.Location or "033_Academy"
    local terrain = BattleData.Terrain or "WildGrass"
    
    local success, err = pcall(function()
        if OriginalRunAway then
            OriginalRunAway(RunAwayEvent, location, terrain)
        else
            RunAwayEvent:FireServer(location, terrain)
        end
    end)
    
    if success then
        print("[Auto Run] Successfully ran away from battle")
        BattleData.InBattle = false
    else
        warn("[Auto Run] Failed:", err)
    end
end

-- Monitor battle state
local function monitorBattle()
    task.spawn(function()
        while true do
            task.wait(2)
            
            if Settings.AutoRun and BattleData.InBattle then
                autoRun()
            end
        end
    end)
end

-- Initialize hooks
hookBattleAction()
detectBattleStart()
detectBattleEnd()
detectBattleState()
hookRunAway()
scanBattleGUI()
scanClientRunner()
monitorBattle()

-- Create GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "AutoBattleGUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Main Frame
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 320, 0, 420)
MainFrame.Position = UDim2.new(0.5, -160, 0.5, -210)
MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 10)
UICorner.Parent = MainFrame

-- Title Bar
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 40)
TitleBar.BackgroundColor3 = Color3.fromRGB(45, 45, 60)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainFrame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 10)
TitleCorner.Parent = TitleBar

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -80, 1, 0)
Title.Position = UDim2.new(0, 10, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "Auto Battle"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 18
Title.Font = Enum.Font.GothamBold
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = TitleBar

-- Close Button
local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -35, 0, 5)
CloseButton.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextSize = 16
CloseButton.Font = Enum.Font.GothamBold
CloseButton.BorderSizePixel = 0
CloseButton.Parent = TitleBar

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 6)
CloseCorner.Parent = CloseButton

CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

-- Content Frame
local ContentFrame = Instance.new("Frame")
ContentFrame.Size = UDim2.new(1, -20, 1, -60)
ContentFrame.Position = UDim2.new(0, 10, 0, 50)
ContentFrame.BackgroundTransparency = 1
ContentFrame.Parent = MainFrame

-- Function to create toggle button
local function createToggle(name, position, callback)
    local ToggleFrame = Instance.new("Frame")
    ToggleFrame.Size = UDim2.new(1, 0, 0, 40)
    ToggleFrame.Position = position
    ToggleFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 60)
    ToggleFrame.BorderSizePixel = 0
    ToggleFrame.Parent = ContentFrame
    
    local ToggleCorner = Instance.new("UICorner")
    ToggleCorner.CornerRadius = UDim.new(0, 8)
    ToggleCorner.Parent = ToggleFrame
    
    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(0.6, 0, 1, 0)
    Label.Position = UDim2.new(0, 10, 0, 0)
    Label.BackgroundTransparency = 1
    Label.Text = name
    Label.TextColor3 = Color3.fromRGB(255, 255, 255)
    Label.TextSize = 14
    Label.Font = Enum.Font.Gotham
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.Parent = ToggleFrame
    
    local ToggleButton = Instance.new("TextButton")
    ToggleButton.Size = UDim2.new(0, 60, 0, 25)
    ToggleButton.Position = UDim2.new(1, -70, 0.5, -12.5)
    ToggleButton.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
    ToggleButton.Text = "OFF"
    ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    ToggleButton.TextSize = 12
    ToggleButton.Font = Enum.Font.GothamBold
    ToggleButton.BorderSizePixel = 0
    ToggleButton.Parent = ToggleFrame
    
    local ButtonCorner = Instance.new("UICorner")
    ButtonCorner.CornerRadius = UDim.new(0, 6)
    ButtonCorner.Parent = ToggleButton
    
    local isEnabled = false
    
    ToggleButton.MouseButton1Click:Connect(function()
        isEnabled = not isEnabled
        ToggleButton.Text = isEnabled and "ON" or "OFF"
        ToggleButton.BackgroundColor3 = isEnabled and Color3.fromRGB(50, 220, 100) or Color3.fromRGB(220, 50, 50)
        callback(isEnabled)
    end)
    
    return ToggleButton
end

-- Function to create move toggle
local function createMoveToggle(moveNum, position)
    local MoveFrame = Instance.new("Frame")
    MoveFrame.Size = UDim2.new(0.48, 0, 0, 35)
    MoveFrame.Position = position
    MoveFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 60)
    MoveFrame.BorderSizePixel = 0
    MoveFrame.Parent = ContentFrame
    
    local MoveCorner = Instance.new("UICorner")
    MoveCorner.CornerRadius = UDim.new(0, 8)
    MoveCorner.Parent = MoveFrame
    
    local MoveButton = Instance.new("TextButton")
    MoveButton.Size = UDim2.new(1, -10, 1, -10)
    MoveButton.Position = UDim2.new(0, 5, 0, 5)
    MoveButton.BackgroundColor3 = Color3.fromRGB(50, 220, 100)
    MoveButton.Text = "Move " .. moveNum
    MoveButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    MoveButton.TextSize = 12
    MoveButton.Font = Enum.Font.GothamBold
    MoveButton.BorderSizePixel = 0
    MoveButton.Parent = MoveFrame
    
    local MoveButtonCorner = Instance.new("UICorner")
    MoveButtonCorner.CornerRadius = UDim.new(0, 6)
    MoveButtonCorner.Parent = MoveButton
    
    MoveButton.MouseButton1Click:Connect(function()
        Settings.EnabledMoves[moveNum] = not Settings.EnabledMoves[moveNum]
        MoveButton.BackgroundColor3 = Settings.EnabledMoves[moveNum] and Color3.fromRGB(50, 220, 100) or Color3.fromRGB(220, 50, 50)
    end)
    
    return MoveButton
end

-- Create toggles
createToggle("Auto Attack", UDim2.new(0, 0, 0, 0), function(enabled)
    Settings.AutoAttack = enabled
    if enabled then
        task.spawn(autoAttack)
    end
end)

createToggle("Auto Run", UDim2.new(0, 0, 0, 50), function(enabled)
    Settings.AutoRun = enabled
end)

-- Moves Label
local MovesLabel = Instance.new("TextLabel")
MovesLabel.Size = UDim2.new(1, 0, 0, 30)
MovesLabel.Position = UDim2.new(0, 0, 0, 110)
MovesLabel.BackgroundTransparency = 1
MovesLabel.Text = "Select Moves to Use:"
MovesLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
MovesLabel.TextSize = 14
MovesLabel.Font = Enum.Font.GothamBold
MovesLabel.TextXAlignment = Enum.TextXAlignment.Left
MovesLabel.Parent = ContentFrame

-- Create move toggles (2x2 grid)
local MoveButtons = {}
MoveButtons[1] = createMoveToggle(1, UDim2.new(0, 0, 0, 145))
MoveButtons[2] = createMoveToggle(2, UDim2.new(0.52, 0, 0, 145))
MoveButtons[3] = createMoveToggle(3, UDim2.new(0, 0, 0, 190))
MoveButtons[4] = createMoveToggle(4, UDim2.new(0.52, 0, 0, 190))

-- Update move button labels when moves are detected
task.spawn(function()
    while true do
        task.wait(2)
        for i, move in ipairs(BattleData.CurrentMoves) do
            if MoveButtons[i] then
                MoveButtons[i].Text = move
            end
        end
    end
end)

-- Run Away Button
local RunButton = Instance.new("TextButton")
RunButton.Size = UDim2.new(1, 0, 0, 45)
RunButton.Position = UDim2.new(0, 0, 0, 245)
RunButton.BackgroundColor3 = Color3.fromRGB(255, 165, 0)
RunButton.Text = "RUN AWAY NOW"
RunButton.TextColor3 = Color3.fromRGB(255, 255, 255)
RunButton.TextSize = 16
RunButton.Font = Enum.Font.GothamBold
RunButton.BorderSizePixel = 0
RunButton.Parent = ContentFrame

local RunCorner = Instance.new("UICorner")
RunCorner.CornerRadius = UDim.new(0, 8)
RunCorner.Parent = RunButton

RunButton.MouseButton1Click:Connect(function()
    autoRun()
end)

-- Info Display
local InfoFrame = Instance.new("ScrollingFrame")
InfoFrame.Size = UDim2.new(1, 0, 0, 60)
InfoFrame.Position = UDim2.new(0, 0, 0, 300)
InfoFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
InfoFrame.BorderSizePixel = 0
InfoFrame.ScrollBarThickness = 4
InfoFrame.Parent = ContentFrame

local InfoCorner = Instance.new("UICorner")
InfoCorner.CornerRadius = UDim.new(0, 8)
InfoCorner.Parent = InfoFrame

local InfoLabel = Instance.new("TextLabel")
InfoLabel.Size = UDim2.new(1, -10, 1, 0)
InfoLabel.Position = UDim2.new(0, 5, 0, 0)
InfoLabel.BackgroundTransparency = 1
InfoLabel.Text = "Battle Info:\nWaiting for battle..."
InfoLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
InfoLabel.TextSize = 11
InfoLabel.Font = Enum.Font.Code
InfoLabel.TextXAlignment = Enum.TextXAlignment.Left
InfoLabel.TextYAlignment = Enum.TextYAlignment.Top
InfoLabel.Parent = InfoFrame

-- Update info display
task.spawn(function()
    while true do
        task.wait(1)
        local info = "Battle Info:\n"
        info = info .. "In Battle: " .. tostring(BattleData.InBattle) .. "\n"
        info = info .. "Moves Detected: " .. #BattleData.CurrentMoves .. "\n"
        info = info .. "Target: " .. (BattleData.CurrentTarget or "None") .. "\n"
        info = info .. "User ID: " .. (BattleData.UserId and "Set" or "None")
        
        InfoLabel.Text = info
        InfoLabel.Size = UDim2.new(1, -10, 0, InfoLabel.TextBounds.Y)
        InfoFrame.CanvasSize = UDim2.new(0, 0, 0, InfoLabel.TextBounds.Y + 10)
    end
end)

-- Parent GUI
if gethui then
    ScreenGui.Parent = gethui()
elseif syn and syn.protect_gui then
    syn.protect_gui(ScreenGui)
    ScreenGui.Parent = game.CoreGui
else
    ScreenGui.Parent = game.CoreGui
end

print("=================================")
print("Auto Battle GUI Loaded!")
print("=================================")
print("Features:")
print("- Automatic target detection")
print("- Automatic move detection")
print("- Automatic user ID detection")
print("- Battle state monitoring")
print("=================================")
print("Waiting for battle to gather info...")
