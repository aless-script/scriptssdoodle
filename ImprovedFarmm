-- Advanced Doodle Hunter with Auto Chain & Preference System
-- Combines encounter farming, stat viewing, and intelligent hunting

getgenv().DoodleHunter = getgenv().DoodleHunter or {
    Active = false,
    ChainActive = false,
    Preferences = {
        TargetSpecies = nil,
        Shiny = nil,
        Gender = nil,
        Skin = nil,
        Ability = nil,
        MinStars = nil,
    },
    Stats = {
        Encounters = 0,
        Chain = 0,
        Kills = 0,
        RunAways = 0,
        MatchesFound = 0,
    },
    CurrentBattle = {
        Active = false,
        WildDoodle = nil,
        PlayerDoodle = nil,
    }
}

local player = game:GetService("Players").LocalPlayer
local remotes = player:WaitForChild("Remotes")
local dudeWhyld = remotes:WaitForChild("DudeWhyld")
local battleAction = remotes:WaitForChild("BattleAction")
local startBattle = remotes:WaitForChild("StartBattle")
local RunService = game:GetService("RunService")

local encounterDelay = 5
local doodleDataQueue = nil

local zoneEncounters = {
    ["025_Sweetsville"] = "WildGrass",
    ["033_Academy"] = "WildGrass",
    ["029_SubwayStation"] = "WildGrass",
    ["TheCarnival"] = "WildGrass",
}

local gui = Instance.new("ScreenGui")
gui.Name = "AdvancedDoodleHunter"
gui.ResetOnSpawn = false
gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local main = Instance.new("Frame")
main.Size = UDim2.new(0, 500, 0, 650)
main.Position = UDim2.new(0.5, -250, 0.5, -325)
main.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
main.BorderSizePixel = 0
main.Active = true
main.Draggable = true
main.Parent = gui

local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 10)
mainCorner.Parent = main

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 40)
title.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
title.BorderSizePixel = 0
title.Text = "Advanced Doodle Hunter"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Font = Enum.Font.GothamBold
title.TextSize = 16
title.Parent = main

local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 10)
titleCorner.Parent = title

local close = Instance.new("TextButton")
close.Size = UDim2.new(0, 30, 0, 30)
close.Position = UDim2.new(1, -35, 0, 5)
close.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
close.Text = "X"
close.TextColor3 = Color3.fromRGB(255, 255, 255)
close.Font = Enum.Font.GothamBold
close.TextSize = 14
close.BorderSizePixel = 0
close.Parent = title

local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(0, 6)
closeCorner.Parent = close

close.MouseButton1Click:Connect(function()
    getgenv().DoodleHunter.Active = false
    getgenv().DoodleHunter.ChainActive = false
    gui:Destroy()
end)

local scrollFrame = Instance.new("ScrollingFrame")
scrollFrame.Size = UDim2.new(1, -20, 1, -100)
scrollFrame.Position = UDim2.new(0, 10, 0, 50)
scrollFrame.BackgroundTransparency = 1
scrollFrame.BorderSizePixel = 0
scrollFrame.ScrollBarThickness = 6
scrollFrame.Parent = main

local scrollList = Instance.new("UIListLayout")
scrollList.Padding = UDim.new(0, 10)
scrollList.Parent = scrollFrame

local function createSection(title_text, height)
    local section = Instance.new("Frame")
    section.Size = UDim2.new(1, -10, 0, height)
    section.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
    section.BorderSizePixel = 0
    section.Parent = scrollFrame

    local sectionCorner = Instance.new("UICorner")
    sectionCorner.CornerRadius = UDim.new(0, 8)
    sectionCorner.Parent = section

    local sectionTitle = Instance.new("TextLabel")
    sectionTitle.Size = UDim2.new(1, -10, 0, 25)
    sectionTitle.Position = UDim2.new(0, 5, 0, 5)
    sectionTitle.BackgroundTransparency = 1
    sectionTitle.Text = title_text
    sectionTitle.TextColor3 = Color3.fromRGB(100, 200, 255)
    sectionTitle.Font = Enum.Font.GothamBold
    sectionTitle.TextSize = 13
    sectionTitle.TextXAlignment = Enum.TextXAlignment.Left
    sectionTitle.Parent = section

    return section
end

local statsSection = createSection("Statistics", 140)

local statsLabels = {}
local statTexts = {
    "Status: Idle",
    "Encounters: 0",
    "Chain: 0",
    "Kills: 0",
    "Run Aways: 0",
    "Matches Found: 0"
}

for i, text in ipairs(statTexts) do
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, -20, 0, 18)
    label.Position = UDim2.new(0, 10, 0, 25 + (i * 18))
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = Color3.fromRGB(220, 220, 220)
    label.Font = Enum.Font.Gotham
    label.TextSize = 11
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = statsSection
    statsLabels[i] = label
end

local prefsSection = createSection("Hunt Preferences", 240)

local function createTextBox(parent, placeholder, yPos)
    local box = Instance.new("TextBox")
    box.Size = UDim2.new(1, -20, 0, 30)
    box.Position = UDim2.new(0, 10, 0, yPos)
    box.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
    box.BorderSizePixel = 0
    box.PlaceholderText = placeholder
    box.Text = ""
    box.TextColor3 = Color3.fromRGB(255, 255, 255)
    box.Font = Enum.Font.Gotham
    box.TextSize = 11
    box.Parent = parent

    local boxCorner = Instance.new("UICorner")
    boxCorner.CornerRadius = UDim.new(0, 6)
    boxCorner.Parent = box

    return box
end

local speciesBox = createTextBox(prefsSection, "Target Species (e.g., Riffrat)", 35)
local shinyBox = createTextBox(prefsSection, "Shiny (true/false or leave empty)", 70)
local genderBox = createTextBox(prefsSection, "Gender (Male/Female or leave empty)", 105)
local skinBox = createTextBox(prefsSection, "Skin (e.g., Default or leave empty)", 140)
local abilityBox = createTextBox(prefsSection, "Ability (e.g., Intimidate or leave empty)", 175)
local starsBox = createTextBox(prefsSection, "Minimum Stars (0-5 or leave empty)", 210)

local settingsSection = createSection("Encounter Settings", 80)

local delayLabel = Instance.new("TextLabel")
delayLabel.Size = UDim2.new(1, -20, 0, 20)
delayLabel.Position = UDim2.new(0, 10, 0, 30)
delayLabel.BackgroundTransparency = 1
delayLabel.Text = "Encounter Delay: 5s"
delayLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
delayLabel.Font = Enum.Font.Gotham
delayLabel.TextSize = 11
delayLabel.TextXAlignment = Enum.TextXAlignment.Left
delayLabel.Parent = settingsSection

local slider = Instance.new("Frame")
slider.Size = UDim2.new(1, -30, 0, 6)
slider.Position = UDim2.new(0, 15, 0, 55)
slider.BackgroundColor3 = Color3.fromRGB(60, 60, 65)
slider.BorderSizePixel = 0
slider.Parent = settingsSection

local sliderCorner = Instance.new("UICorner")
sliderCorner.CornerRadius = UDim.new(1, 0)
sliderCorner.Parent = slider

local sliderBtn = Instance.new("TextButton")
sliderBtn.Size = UDim2.new(0, 20, 0, 20)
sliderBtn.Position = UDim2.new(0.2, -10, 0.5, -10)
sliderBtn.BackgroundColor3 = Color3.fromRGB(100, 150, 255)
sliderBtn.Text = ""
sliderBtn.BorderSizePixel = 0
sliderBtn.Parent = slider

local btnCorner = Instance.new("UICorner")
btnCorner.CornerRadius = UDim.new(1, 0)
btnCorner.Parent = sliderBtn

local dragging = false
sliderBtn.MouseButton1Down:Connect(function()
    dragging = true
end)

game:GetService("UserInputService").InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)

RunService.RenderStepped:Connect(function()
    if dragging then
        local mouse = player:GetMouse()
        local relativeX = math.clamp(mouse.X - slider.AbsolutePosition.X, 0, slider.AbsoluteSize.X)
        local percent = relativeX / slider.AbsoluteSize.X
        sliderBtn.Position = UDim2.new(percent, -10, 0.5, -10)
        encounterDelay = math.floor(1 + (percent * 19))
        delayLabel.Text = "Encounter Delay: " .. encounterDelay .. "s"
    end
end)

local doodleSection = createSection("Current Wild Doodle", 200)

local doodleScroll = Instance.new("ScrollingFrame")
doodleScroll.Size = UDim2.new(1, -20, 1, -35)
doodleScroll.Position = UDim2.new(0, 10, 0, 30)
doodleScroll.BackgroundTransparency = 1
doodleScroll.BorderSizePixel = 0
doodleScroll.ScrollBarThickness = 4
doodleScroll.Parent = doodleSection

local doodleList = Instance.new("UIListLayout")
doodleList.Padding = UDim.new(0, 3)
doodleList.Parent = doodleScroll

local buttonFrame = Instance.new("Frame")
buttonFrame.Size = UDim2.new(1, -20, 0, 40)
buttonFrame.Position = UDim2.new(0, 10, 1, -50)
buttonFrame.BackgroundTransparency = 1
buttonFrame.Parent = main

local startBtn = Instance.new("TextButton")
startBtn.Size = UDim2.new(0.48, 0, 1, 0)
startBtn.Position = UDim2.new(0, 0, 0, 0)
startBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 100)
startBtn.Text = "Start Hunting"
startBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
startBtn.Font = Enum.Font.GothamBold
startBtn.TextSize = 13
startBtn.BorderSizePixel = 0
startBtn.Parent = buttonFrame

local startCorner = Instance.new("UICorner")
startCorner.CornerRadius = UDim.new(0, 8)
startCorner.Parent = startBtn

local resetBtn = Instance.new("TextButton")
resetBtn.Size = UDim2.new(0.48, 0, 1, 0)
resetBtn.Position = UDim2.new(0.52, 0, 0, 0)
resetBtn.BackgroundColor3 = Color3.fromRGB(255, 150, 50)
resetBtn.Text = "Reset Stats"
resetBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
resetBtn.Font = Enum.Font.GothamBold
resetBtn.TextSize = 13
resetBtn.BorderSizePixel = 0
resetBtn.Parent = buttonFrame

local resetCorner = Instance.new("UICorner")
resetCorner.CornerRadius = UDim.new(0, 8)
resetCorner.Parent = resetBtn

pcall(function()
    if gethui then
        gui.Parent = gethui()
    elseif syn and syn.protect_gui then
        syn.protect_gui(gui)
        gui.Parent = player.PlayerGui
    else
        gui.Parent = player.PlayerGui
    end
end)

local function updateStats()
    local stats = getgenv().DoodleHunter.Stats
    local status = "Idle"

    if getgenv().DoodleHunter.Active then
        if getgenv().DoodleHunter.CurrentBattle.Active then
            status = "In Battle"
        else
            status = "Hunting"
        end
    end

    statsLabels[1].Text = "Status: " .. status
    statsLabels[2].Text = "Encounters: " .. stats.Encounters
    statsLabels[3].Text = "Chain: " .. stats.Chain
    statsLabels[4].Text = "Kills: " .. stats.Kills
    statsLabels[5].Text = "Run Aways: " .. stats.RunAways
    statsLabels[6].Text = "Matches Found: " .. stats.MatchesFound

    if stats.MatchesFound > 0 then
        statsLabels[6].TextColor3 = Color3.fromRGB(100, 255, 100)
    end
end

local function createDoodleLabel(text, value, color)
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 0, 18)
    label.BackgroundTransparency = 1
    label.Text = text .. ": " .. tostring(value)
    label.TextColor3 = color or Color3.fromRGB(220, 220, 220)
    label.Font = Enum.Font.Gotham
    label.TextSize = 10
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = doodleScroll
    return label
end

local function displayDoodle(data)
    for _, child in ipairs(doodleScroll:GetChildren()) do
        if child:IsA("TextLabel") then
            child:Destroy()
        end
    end

    if not data then
        createDoodleLabel("Status", "Waiting for encounter...", Color3.fromRGB(200, 200, 200))
        return
    end

    createDoodleLabel("Name", data.Name or data.RealName or "Unknown", Color3.fromRGB(255, 200, 100))
    createDoodleLabel("Species", data.Species or data.RealName or "Unknown", Color3.fromRGB(255, 150, 255))

    if data.Shiny ~= nil then
        local color = data.Shiny and Color3.fromRGB(255, 215, 0) or Color3.fromRGB(200, 200, 200)
        createDoodleLabel("Shiny", tostring(data.Shiny), color)
    end

    if data.Gender then
        createDoodleLabel("Gender", data.Gender, Color3.fromRGB(255, 180, 255))
    end

    if data.Skin then
        createDoodleLabel("Skin", data.Skin, Color3.fromRGB(255, 200, 150))
    end

    if data.Trait or data.Ability then
        createDoodleLabel("Ability", data.Trait or data.Ability, Color3.fromRGB(255, 200, 255))
    end

    if data.Star then
        createDoodleLabel("Stars", data.Star, Color3.fromRGB(255, 255, 100))
    end

    task.wait()
    doodleScroll.CanvasSize = UDim2.new(0, 0, 0, doodleList.AbsoluteContentSize.Y + 5)
end

local function parsePreferences()
    local prefs = getgenv().DoodleHunter.Preferences

    prefs.TargetSpecies = speciesBox.Text ~= "" and speciesBox.Text or nil

    if shinyBox.Text ~= "" then
        prefs.Shiny = shinyBox.Text:lower() == "true"
    else
        prefs.Shiny = nil
    end

    prefs.Gender = genderBox.Text ~= "" and genderBox.Text or nil
    prefs.Skin = skinBox.Text ~= "" and skinBox.Text or nil
    prefs.Ability = abilityBox.Text ~= "" and abilityBox.Text or nil

    if starsBox.Text ~= "" then
        prefs.MinStars = tonumber(starsBox.Text)
    else
        prefs.MinStars = nil
    end
end

local function checkDoodleMatch(doodle)
    local prefs = getgenv().DoodleHunter.Preferences

    if not prefs.TargetSpecies then
        return false, "No target species set"
    end

    local species = doodle.Species or doodle.RealName or doodle.Name
    if not species or species:lower() ~= prefs.TargetSpecies:lower() then
        return false, "Different species"
    end

    if prefs.Shiny ~= nil and doodle.Shiny ~= prefs.Shiny then
        return false, "Shiny mismatch"
    end

    if prefs.Gender and doodle.Gender and doodle.Gender:lower() ~= prefs.Gender:lower() then
        return false, "Gender mismatch"
    end

    if prefs.Skin and doodle.Skin and doodle.Skin:lower() ~= prefs.Skin:lower() then
        return false, "Skin mismatch"
    end

    if prefs.Ability then
        local ability = doodle.Trait or doodle.Ability
        if ability and ability:lower() ~= prefs.Ability:lower() then
            return false, "Ability mismatch"
        end
    end

    if prefs.MinStars and doodle.Star and doodle.Star < prefs.MinStars then
        return false, "Not enough stars"
    end

    return true, "Perfect match!"
end

local function performBattleAction(actionType, target, user, action)
    local args = {
        {
            {
                Target = target,
                ActionType = actionType,
                Action = action or "Run",
                User = user
            }
        }
    }

    pcall(function()
        battleAction:FireServer(unpack(args))
    end)
end

local function handleBattle(battleData)
    if not getgenv().DoodleHunter.Active then return end

    getgenv().DoodleHunter.CurrentBattle.Active = true

    if battleData.Player2Party and #battleData.Player2Party > 0 then
        local wildDoodle = battleData.Player2Party[1]
        getgenv().DoodleHunter.CurrentBattle.WildDoodle = wildDoodle

        if battleData.Player1Party and #battleData.Player1Party > 0 then
            getgenv().DoodleHunter.CurrentBattle.PlayerDoodle = battleData.Player1Party[1]
        end

        doodleDataQueue = wildDoodle

        local prefs = getgenv().DoodleHunter.Preferences
        local species = wildDoodle.Species or wildDoodle.RealName or wildDoodle.Name

        if not prefs.TargetSpecies then
            warn("[Hunter] No target species set!")
            return
        end

        local isTargetSpecies = species and species:lower() == prefs.TargetSpecies:lower()
        local isMatch, reason = checkDoodleMatch(wildDoodle)

        if isMatch then
            print("[Hunter] PERFECT MATCH FOUND! Stopping hunt.")
            getgenv().DoodleHunter.Stats.MatchesFound = getgenv().DoodleHunter.Stats.MatchesFound + 1
            getgenv().DoodleHunter.Active = false
            getgenv().DoodleHunter.ChainActive = false
            updateStats()
            return
        end

        if isTargetSpecies then
            print("[Hunter] Target species but not perfect (" .. reason .. "). Attacking to build chain...")
            getgenv().DoodleHunter.Stats.Chain = getgenv().DoodleHunter.Stats.Chain + 1
            getgenv().DoodleHunter.Stats.Kills = getgenv().DoodleHunter.Stats.Kills + 1

            task.wait(1)

            local playerDoodle = getgenv().DoodleHunter.CurrentBattle.PlayerDoodle
            local wildID = wildDoodle.ID or wildDoodle.id
            local playerID = playerDoodle and (playerDoodle.ID or playerDoodle.id)

            if wildID and playerID then
                local moves = playerDoodle.Moves or playerDoodle.moves or {}
                local firstMove = "Tackle"

                if #moves > 0 then
                    if type(moves[1]) == "table" then
                        firstMove = moves[1].Name or moves[1].name or "Tackle"
                    else
                        firstMove = moves[1]
                    end
                end

                performBattleAction("Attack", wildID, playerID, firstMove)
            end
        else
            print("[Hunter] Wrong species. Running away to preserve chain...")
            getgenv().DoodleHunter.Stats.RunAways = getgenv().DoodleHunter.Stats.RunAways + 1

            task.wait(1)

            local playerDoodle = getgenv().DoodleHunter.CurrentBattle.PlayerDoodle
            local wildID = wildDoodle.ID or wildDoodle.id
            local playerID = playerDoodle and (playerDoodle.ID or playerDoodle.id)

            if wildID and playerID then
                performBattleAction("Run", wildID, playerID, "Run")
            end
        end

        updateStats()
    end

    task.wait(2)
    getgenv().DoodleHunter.CurrentBattle.Active = false
end

local function getCurrentZone()
    local workspace = game:GetService("Workspace")

    for _, obj in ipairs(workspace:GetChildren()) do
        local name = obj.Name
        if name:match("^%d%d%d_") or zoneEncounters[name] then
            return name
        end
    end

    return nil
end

local function triggerEncounter()
    local zone = getCurrentZone()

    if not zone then
        return false
    end

    local encounterType = zoneEncounters[zone]

    if not encounterType then
        return false
    end

    pcall(function()
        dudeWhyld:FireServer(zone, encounterType)
    end)

    getgenv().DoodleHunter.Stats.Encounters = getgenv().DoodleHunter.Stats.Encounters + 1
    updateStats()

    return true
end

startBtn.MouseButton1Click:Connect(function()
    if not getgenv().DoodleHunter.Active then
        parsePreferences()

        if not getgenv().DoodleHunter.Preferences.TargetSpecies then
            warn("[Hunter] Please set a target species!")
            return
        end

        getgenv().DoodleHunter.Active = true
        getgenv().DoodleHunter.ChainActive = true
        startBtn.Text = "Stop Hunting"
        startBtn.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
        print("[Hunter] Started hunting for: " .. getgenv().DoodleHunter.Preferences.TargetSpecies)
    else
        getgenv().DoodleHunter.Active = false
        getgenv().DoodleHunter.ChainActive = false
        startBtn.Text = "Start Hunting"
        startBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 100)
        print("[Hunter] Stopped hunting")
    end
    updateStats()
end)

resetBtn.MouseButton1Click:Connect(function()
    getgenv().DoodleHunter.Stats = {
        Encounters = 0,
        Chain = 0,
        Kills = 0,
        RunAways = 0,
        MatchesFound = 0,
    }
    updateStats()
    print("[Hunter] Stats reset")
end)

RunService.RenderStepped:Connect(function()
    if doodleDataQueue then
        local data = doodleDataQueue
        doodleDataQueue = nil
        displayDoodle(data)
    end

    task.wait()
    scrollFrame.CanvasSize = UDim2.new(0, 0, 0, scrollList.AbsoluteContentSize.Y + 10)
end)

task.spawn(function()
    task.wait(2)

    while task.wait(1) do
        if getgenv().DoodleHunter.Active and not getgenv().DoodleHunter.CurrentBattle.Active then
            if triggerEncounter() then
                task.wait(encounterDelay)
            else
                task.wait(3)
            end
        end
    end
end)

startBattle.OnClientEvent:Connect(function(battleData)
    if type(battleData) == "table" then
        handleBattle(battleData)
    end
end)

updateStats()
displayDoodle(nil)

print([[
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  ADVANCED DOODLE HUNTER
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ Loaded Successfully!

Features:
  - Auto encounter farming
  - Preference-based hunting
  - Auto chain building
  - Smart battle decisions
  - Real-time stat tracking

How to use:
  1. Set your target species
  2. (Optional) Set preferences
  3. Click "Start Hunting"
  4. Script will auto-chain until match!

Chain Logic:
  ✓ Target species + match = STOP
  ✓ Target species + no match = KILL (chain++)
  ✗ Different species = RUN (preserve chain)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
]])
