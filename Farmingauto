-- [[ SENTINEL: TARGETED CHAIN-KILLER ]]
local Player = game:GetService("Players").LocalPlayer
local Remotes = Player:WaitForChild("Remotes")

-- CONFIGURATION (Change these to your liking)
getgenv().AutoFarm = true
getgenv().CHAIN_TARGET = "Grimsugar" -- THE DOODLE YOU WANT TO KILL
local MIN_STARS = 5                 -- Stop for 5+ stars
local ATTACK_MOVE = "Wave Shot"     -- Your lead Doodle's first-slot move
local AREA_ID = "025_Sweetsville"   -- Christmas 2025 Area ID

-- DATA STORAGE
local MyLeadID = ""

-- [ 1. SYNC YOUR LEAD DOODLE ]
Remotes.UpdateLead.OnClientEvent:Connect(function(data)
    if data and data.Doodle then
        MyLeadID = data.Doodle.ID
        print("üîÑ Lead Synced: " .. data.Doodle.Name .. " (ID: " .. MyLeadID:sub(1,8) .. ")")
    end
end)

-- [ 2. THE BATTLE ENGINE ]
local mtHook; mtHook = hookmetamethod(game, "__namecall", function(self, ...)
    local method = getnamecallmethod()
    local args = {...}

    if self == Remotes.StartBattle and method == "FireServer" and getgenv().AutoFarm then
        local data = args[1]
        local wild = data.Player2Party[1]
        
        -- Logic Checks
        local isTarget = (wild.RealName == getgenv().CHAIN_TARGET)
        local isRare = (wild.Star >= MIN_STARS or wild.Shiny or wild.HiddenTrait)

        print("üì° ENCOUNTER: " .. wild.RealName .. " | Target: " .. getgenv().CHAIN_TARGET)

        task.spawn(function()
            task.wait(2.8) -- Wait for Battle UI
            
            if isTarget and not isRare then
                -- ‚öîÔ∏è KILL TARGET: Building the chain
                print("‚öîÔ∏è KO'ing " .. wild.RealName .. " to increase chain...")
                Remotes.BattleAction:FireServer({
                    {
                        ["Target"] = wild.UUID,
                        ["ActionType"] = "Attack",
                        ["Action"] = ATTACK_MOVE,
                        ["User"] = MyLeadID
                    }
                })
            elseif isTarget and isRare then
                -- üö® STOP: You found the rare version of your target!
                getgenv().AutoFarm = false
                print("üö® !!! RARE TARGET FOUND: " .. wild.RealName .. " !!!")
                print("‚≠ê Stars: " .. wild.Star .. " | ‚ú® Shiny: " .. tostring(wild.Shiny))
            else
                -- üèÉ RUN: If it's not the target, flee immediately to save time
                print("üèÉ Not " .. getgenv().CHAIN_TARGET .. ". Fleeing...")
                Remotes.BattleAction:FireServer("Run")
            end
        end)
    end
    return mtHook(self, ...)
end)

-- [ 3. THE AUTO-ENCOUNTER LOOP ]
task.spawn(function()
    while task.wait(4) do
        if getgenv().AutoFarm and not Player.PlayerGui:FindFirstChild("BattleGui") then
            -- Handshake
            Remotes.RequestChunk:InvokeServer(AREA_ID)
            task.wait(0.2)
            -- Trigger Encounter
            Remotes.DudeWhyld:FireServer(AREA_ID, "WildGrass")
            print("üë£ Searching for " .. getgenv().CHAIN_TARGET .. "...")
        end
    end
end)
