local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local Title = Instance.new("TextLabel")
local StatusLabel = Instance.new("TextLabel")
local ToggleButton = Instance.new("TextButton")
local ConfigFrame = Instance.new("ScrollingFrame")
local UIListLayout = Instance.new("UIListLayout")

-- Setup GUI Properties
ScreenGui.Name = "DoodleHunter"
ScreenGui.Parent = game:GetService("CoreGui")
ScreenGui.ResetOnSpawn = false

MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.05, 0, 0.3, 0)
MainFrame.Size = UDim2.new(0, 220, 0, 300)
MainFrame.Active = true
MainFrame.Draggable = true

Title.Parent = MainFrame
Title.Size = UDim2.new(1, 0, 0, 30)
Title.Text = "PRECISE HUNTER"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.BackgroundColor3 = Color3.fromRGB(50, 50, 50)

StatusLabel.Parent = MainFrame
StatusLabel.Position = UDim2.new(0, 0, 0, 30)
StatusLabel.Size = UDim2.new(1, 0, 0, 25)
StatusLabel.Text = "Status: Awaiting Remote..."
StatusLabel.TextColor3 = Color3.fromRGB(255, 200, 0)

ConfigFrame.Parent = MainFrame
ConfigFrame.Position = UDim2.new(0, 5, 0, 60)
ConfigFrame.Size = UDim2.new(1, -10, 0, 180)
ConfigFrame.BackgroundTransparency = 1
ConfigFrame.CanvasSize = UDim2.new(0, 0, 1.5, 0)

UIListLayout.Parent = ConfigFrame
UIListLayout.Padding = UDim.new(0, 5)

-- Settings Table
getgenv().HunterSettings = {
    Enabled = false,
    TargetSpecies = "Pupskey",
    MinStars = 5,
    StopMisprint = true,
    StopSkin = true,
    StopHT = true,
    Area = nil,
    SubArea = nil
}

-- Helper function to create toggles
local function createToggle(text, settingKey)
    local btn = Instance.new("TextButton")
    btn.Parent = ConfigFrame
    btn.Size = UDim2.new(1, -10, 0, 30)
    btn.BackgroundColor3 = getgenv().HunterSettings[settingKey] and Color3.fromRGB(0, 150, 0) or Color3.fromRGB(150, 0, 0)
    btn.Text = text
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    
    btn.MouseButton1Click:Connect(function()
        getgenv().HunterSettings[settingKey] = not getgenv().HunterSettings[settingKey]
        btn.BackgroundColor3 = getgenv().HunterSettings[settingKey] and Color3.fromRGB(0, 150, 0) or Color3.fromRGB(150, 0, 0)
    end)
end

createToggle("Stop Misprint", "StopMisprint")
createToggle("Stop Skin", "StopSkin")
createToggle("Stop Hidden Trait", "StopHT")

-- Logic Variables
local player = game:GetService("Players").LocalPlayer
local remotes = player:WaitForChild("Remotes")
local dataRemote = remotes:WaitForChild("PlayerDataFunc")
local encounterRemote = remotes:WaitForChild("DudeWhyld")
local battleRemote = game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("BattleRemote")

-- 1. THE HOOK (Detects your area)
local mt = getrawmetatable(game)
local oldNamecall = mt.__namecall
setreadonly(mt, false)
mt.__namecall = newcclosure(function(self, ...)
    local method = getnamecallmethod()
    local args = {...}
    if self == encounterRemote and method == "FireServer" then
        getgenv().HunterSettings.Area = args[1]
        getgenv().HunterSettings.SubArea = args[2]
        StatusLabel.Text = "Area: " .. tostring(args[2])
    end
    return oldNamecall(self, ...)
end)
setreadonly(mt, true)

-- 2. THE MAIN AUTO-HUNT LOGIC
task.spawn(function()
    while true do
        task.wait(1)
        if getgenv().HunterSettings.Enabled and getgenv().HunterSettings.Area then
            local battleData = dataRemote:InvokeServer("GetBattleData")
            local wild = battleData and battleData.Opponent
            
            if not wild then
                encounterRemote:FireServer(getgenv().HunterSettings.Area, getgenv().HunterSettings.SubArea)
                task.wait(2)
            else
                local isTrophy = (wild.Stars >= getgenv().HunterSettings.MinStars) or
                                 (getgenv().HunterSettings.StopMisprint and wild.IsMisprint) or
                                 (getgenv().HunterSettings.StopSkin and wild.Skin ~= nil) or
                                 (getgenv().HunterSettings.StopHT and wild.IsHiddenTrait)

                if isTrophy then
                    getgenv().HunterSettings.Enabled = false
                    StatusLabel.Text = "‚ú® TARGET FOUND!"
                    StatusLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
                elseif wild.Name == getgenv().HunterSettings.TargetSpecies then
                    StatusLabel.Text = "‚öîÔ∏è Chaining: " .. wild.Name
                    battleRemote:FireServer("UseMove", 1)
                    repeat task.wait(1) until dataRemote:InvokeServer("GetBattleData") == nil
                else
                    StatusLabel.Text = "üèÉ Running: " .. wild.Name
                    battleRemote:FireServer("Run")
                    repeat task.wait(1) until dataRemote:InvokeServer("GetBattleData") == nil
                end
            end
        end
    end
end)

-- Master Toggle Button
ToggleButton.Parent = MainFrame
ToggleButton.Position = UDim2.new(0, 5, 0, 250)
ToggleButton.Size = UDim2.new(1, -10, 0, 40)
ToggleButton.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
ToggleButton.Text = "START HUNTER"
ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)

ToggleButton.MouseButton1Click:Connect(function()
    if not getgenv().HunterSettings.Area then
        StatusLabel.Text = "‚ùå Fire Remote Manually First!"
        return
    end
    getgenv().HunterSettings.Enabled = not getgenv().HunterSettings.Enabled
    ToggleButton.Text = getgenv().HunterSettings.Enabled and "STOP HUNTER" or "START HUNTER"
    ToggleButton.BackgroundColor3 = getgenv().HunterSettings.Enabled and Color3.fromRGB(200, 50, 50) or Color3.fromRGB(100, 100, 100)
end)
